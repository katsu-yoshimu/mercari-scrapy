# mercariスクレーピング処理（トライアル版）

[メルカリ](https://jp.mercari.com/) を検索キーワード「時計 tag heuer」で検索して「新しい順」ソートした一覧ページ、および、詳細ページをスクレーピングするためのPythonスクリプトです。スクレーピングに「selenium」を利用しています。

## 目次

- [インストール](#インストール)
- [実行](#実行)
- [ライセンス](#ライセンス)

## インストール

前提：ローカルPC(Win10)に **git、python3.12** がインストール済

1. **ローカルPCにリポジトリのクーロン作成:**

   ```cmd
   cd %適当なディレクトリ%
   git clone https://github.com/katsu-yoshimu/mercari-scrapy.git
   ```

2. **ローカルPCに仮想完了作成と仮想環境アクティベート:**

   ```cmd
   python -m venv venv
   venv\Scripts\activate
   ```

3. **ローカルPCに必要なPythonパッケージをインストール:**

   ```cmd
   cd mercari-scrapy
   pip install -r requirements.txt
   ```

## 実行

1. **スクリプト実行:**

   ```cmd
   python trial.py
   ```

2. **実行結果:**

   「./output」ディレクトリにExcelファイルを作成します。作成時刻ごとにファイルを作成します。以下は「./output」ディレクトリの例です。

   ```cmd
   dir output
   2024/12/05  09:16            84,038 output_20241205_091619.xlsx
   ```

3. **補足:**

   - スクリプト実行中に自動起動されるブラウザは手動操作しないでください。このブラウザを非表示にすることも可能です。「selenimuContorller.py」のコメントアウトしている「# options.add_argument('--headless')」を「options.add_argument('--headless')」と変更して有効化してください。

   - 検索キーワードは「trial.py」の「key_word = '時計 tag heuer'」にて指定しています。必要に応じて変更してください。

   - トライアル版につき、明示的に課題を残しています。今後の対応とさせてください。

     - seleniumで自動起動されるブラウザに「お使いのブラウザがWebサイトに対応していない、または最新版でない可能性があります。」と表示されます。

     - seleniumにて、inputタグへの検索キーワード入力、selectタグの「新しい順」の選択、などを実施しています。これらのタグが入力可能、選択可能となるまで、固定5秒の待ち合わせをしています。タグの入力可能、選択可能状態を判定していません。

     - 詳細ページにて「再実行を促される」ページが表示されることがあります。再実行せず処理スキップしています。

   - トライアル版につき、エラー処理は不完全な箇所があります。エラーが発生した場合の原因調査の上、スクリプトでの対応の可否を判断し、ご相談の上で、スクリプト修正を実施します。

   - 「Server disconected」ページが表示されることがあります。実行マシンが不安定な場合に発生します。Python再実行するほか回復方法がないため、「スクリプトの再実行」をする運用をお願いします。

   - [メルカリ](https://jp.mercari.com/) サイトへのアクセス集中を回避するため、アクセス間隔は約3秒（正確には「3秒±20%」）以上となるように待機時間を設けています。なお、「3秒」は「selenimuContorller.py」の「INTERVAL_TIME = 3」で設定しており変更は容易です。

   - Web API化は今後の課題との認識です。いくつかの基盤で動作検証を行い、別途、提案させていただきます。

## ライセンス

ライセンスは Apache2 License に準拠します。
